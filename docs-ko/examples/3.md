# 문서 시스템을 활용한 도메인 전문가 에이전트

이 예제는 **문서를 AI 에이전트에게 제공하여 전문적인 분석을 수행**하는 워크플로우를 보여줍니다. 법률 문서를 예시로, 에이전트가 문서 내용을 참조하여 질문에 답변하는 과정을 확인할 수 있습니다.

## 핵심 아이디어: 문서 + 에이전트

이 워크플로우의 핵심은 **외부 문서를 에이전트의 시스템 프롬프트에 포함**시키는 것입니다:

```yaml
version: "agentflow/v1"
kind: "WorkflowSpec"
metadata:
  name: "문서 기반 전문가 에이전트"
  description: "문서 내용을 참조하는 도메인 전문가 AI"
  version: "0.1.0"

agents:
  - id: "lawyer_agent"
    inline:
      type: "agent"
      model: "openai/gpt-4.1-mini"
      system_prompt: |
        You are a lawyer.
        Answer the questions based on the content of the document below.
        Please include references in your answer.

        Provide your answer in JSON format.
        Example:
        {
          "answer": "The answer is OOO.",
          "references": [
            "Document1",
            "Document2"
          ] 
        }
        
        <help>  
          Use the document name attribute to indicate your references.
        </help>

        <document name="Genius act">
          {{{documents.genius_act.content}}}
        </document>

nodes:
  start:
    type: "agent_task"
    agent: "lawyer_agent"
    next: "end"
  
  end:
    type: "end"
```

## 문서 시스템 작동 방식

워크플로우에서 문서를 활용하는 핵심은 `{{{documents.genius_act.content}}}` 템플릿 문법입니다:

```javascript
const documents = {
  'genius_act': {
    type: 'markdown',
    filters: [new RemoveBase64ImageFilter()], // 이미지 제거
    content: readFileSync('./docs/Genius act.md', 'utf-8')
  }
};

const workflow = new Workflow({
  mainWorkflow: workflowYaml,
  documents, // 문서 전달
  responseFilters: [new RemoveMarkdownJsonFilter()] // JSON 응답 정리
});
```

## 실제 실행 결과

```javascript
const result = await workflow.ask("미국이 왜 이 법안을 발의했을까?");
```

**실제 응답:**
```json
{
  "answer": "미국이 이 법안, 즉 GENIUS Act of 2025를 발의한 주요 목적은 결제용 스테이블코인(payment stablecoins)의 규제를 체계화하고 안정성을 확보하기 위함입니다. 법안은 스테이블코인의 발행과 운영에 관한 명확한 기준을 설정하여 금융 시스템의 안전과 건전성을 보장하고, 소비자 보호를 강화하며, 금융 안정성에 대한 위험을 관리하고자 합니다.",
  "references": [
    "Genius act - SECTION 1. Short title.",
    "Genius act - SEC. 3. Limitation on who may issue a payment stablecoin.",
    "Genius act - SEC. 4. Requirements for issuing payment stablecoins.",
    "Genius act - SEC. 6. Supervision and enforcement with respect to subsidiaries of insured depository institutions and Comptroller-regulated entities.",
    "Genius act - SEC. 8. Customer protection.",
    "Genius act - SEC. 9. Treatment of insolvent payment stablecoin issuers."
  ]
}
```

**실행 통계:**
```
총 실행 시간: 7.15초
노드 실행: start(7087ms) -> end(0ms)
응답 필터: 마크다운 코드 블록 제거됨
```

## 다른 활용 예시

이 문서 시스템을 다른 도메인에도 활용할 수 있습니다:

### 의료 문서 분석
```yaml
<document name="임상시험 보고서">
  {{{documents.clinical_report.content}}}
</document>
```

### 기술 문서 분석  
```yaml
<document name="API 명세서">
  {{{documents.api_spec.content}}}
</document>
```

### 계약서 검토
```yaml
<document name="계약서">
  {{{documents.contract.content}}}
</document>
```

## 핵심 포인트

1. **문서 주입**: `{{{documents.key.content}}}` 문법으로 문서를 시스템 프롬프트에 포함
2. **필터링**: Base64 이미지 제거 등 전처리 가능  
3. **구조화된 응답**: JSON 형태로 답변과 참조 정보 제공
4. **도메인 전문성**: 에이전트가 특정 분야 전문가 역할 수행

이것이 SowonFlow의 **문서 시스템을 활용한 도메인 전문가 에이전트**의 핵심입니다.
